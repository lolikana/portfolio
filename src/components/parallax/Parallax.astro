---
import Background from '@assets/parallax/background.webp';
import Dust from '@assets/parallax/dust.webp';
import Foreground from '@assets/parallax/foreground.webp';
import Logo from '@components/ui/Logo.astro';
import { Image } from 'astro:assets';
// import { getImage, Image } from 'astro:assets';

// const optimizedForeground = await getImage({ src: Foreground, format: 'avif' });
---

<div class="parallax">
	<div class="parallax__hero">
		<slot name="hero-section" />
	</div>
	<div class="parallax__bg">
		<Image src={Background} alt="Background Image" />
	</div>
	<div class="parallax__fg">
		<Image
			src={Foreground}
			alt="Foreground Image"
			widths={[240, 540, 720, Dust.width]}
			sizes={`(max-width: 360px) 240px, (max-width: 720px) 540px, (max-width: 1600px) 720px, ${Dust.width}px`}
		/>
	</div>
	<!-- <div class="parallax__fg" style={`background-image: url(${optimizedForeground.src})`}>
	</div> -->
	<div class="parallax__dust">
		<Image
			src={Dust}
			alt="Dust Image"
			widths={[240, 540, 720, Dust.width]}
			sizes={`(max-width: 360px) 240px, (max-width: 720px) 540px, (max-width: 1600px) 720px, ${Dust.width}px`}
		/>
	</div>
	<div class="parallax__logo">
		<Logo type={2} />
	</div>
	<div class="parallax__foreground-back"></div>
	<div class="parallax__foreground-front"></div>
</div>

<style lang="scss">
	.parallax {
		--parallax-speed-hero: 20;
		--parallax-speed-bg: 7;
		--parallax-speed-fg: -2;
		--parallax-speed-dust: -5;
		--parallax-speed-logo: 5;

		--parallax-index-hero: 5;
		--parallax-index-bg: 1;
		--parallax-index-fg: 4;
		--parallax-index-dust: 2;
		--parallax-index-logo: 3;

		position: relative;
		z-index: 0;
		height: 80vh;
		display: grid;
		grid-template-rows: 100%;
		grid-template-areas: 'stack';
		contain: paint;
	}

	.parallax > * {
		grid-area: stack;
		animation: parallax linear;
		animation-timeline: scroll();
	}

	.parallax img {
		width: 100%;
		object-fit: cover;
	}

	.parallax__hero {
		--parallax-speed: var(--parallax-speed-hero);
		z-index: var(--parallax-index-hero);
		width: fit-content;
		height: fit-content;
	}

	.parallax__bg {
		--parallax-speed: var(--parallax-speed-bg);
		z-index: var(--parallax-index-bg);
	}

	.parallax__fg {
		--parallax-speed: var(--parallax-speed-fg);
		height: 70vh;
		z-index: var(--parallax-index-fg);
		position: relative;
		background-size: cover;
		background-position: top center;
		bottom: -20rem;
		transition: bottom 500ms ease;
		img {
			overflow: visible;
		}
		@include mq('md') {
			bottom: -16rem;
		}
		@include mq('lg') {
			bottom: -10rem;
		}
		@include mq('xl') {
			bottom: -5rem;
		}
	}

	.parallax__dust {
		--parallax-speed: var(--parallax-speed-dust);
		z-index: var(--parallax-index-dust);
	}

	.parallax__logo {
		--parallax-speed: var(--parallax-speed-logo);
		z-index: var(--parallax-index-logo);
		position: absolute;
		right: 13vw;
		top: 10rem;
		width: 10vw;
		height: 10vw;
		min-width: 75px;
		min-height: 75px;
		max-width: 250px;
		max-height: 250px;
		filter: drop-shadow(0px 0px 20px rgba(0, 0, 0, 0.8));
	}

	.parallax__foreground-front,
	.parallax__foreground-back {
		clip-path: polygon(
			100% 100%,
			0% 100%,
			0 100%,
			6% 86%,
			21% 83%,
			37% 73%,
			54% 73%,
			70% 50%,
			88% 47%,
			100% 14%
		);
		width: calc(100% + 2rem);
		height: 200px;
		align-self: end;
		margin-left: -2rem;
		margin-bottom: -0.5rem;
		z-index: 10;
	}

	.parallax__foreground-back {
		background-color: $tertiary-color;
		transform: scaleY(1.2);
		transform-origin: bottom;
		opacity: 0.7;
	}

	@keyframes parallax {
		to {
			transform: translateY(calc(var(--parallax-speed) * 100px));
		}
	}
</style>
